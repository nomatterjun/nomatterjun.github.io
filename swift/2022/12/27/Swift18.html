<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h1 id="ë‹¤ìš´ìƒ˜í”Œë§ìœ¼ë¡œ-ë©”ëª¨ë¦¬-íš¨ìœ¨ì ì¸-ì´ë¯¸ì§€-ì²˜ë¦¬í•˜ê¸°">ë‹¤ìš´ìƒ˜í”Œë§ìœ¼ë¡œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì ì¸ ì´ë¯¸ì§€ ì²˜ë¦¬í•˜ê¸°</h1>

<p>ì´ì „ ê²Œì‹œë¬¼ì—ì„œ ì•Œì•„ë³´ì•˜ë˜ <code class="language-plaintext highlighter-rouge">PHPicker</code>ë¥¼ ì‚¬ìš©í•´ì„œ ì´ë¯¸ì§€ë¥¼ ì²˜ë¦¬í•˜ë˜ ì¤‘ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ë¥¼ ë§ˆì£¼ì³¤ìŠµë‹ˆë‹¤.</p>

<p><img src="https://i.imgur.com/PIZF0mw.png" alt=""></p>

<p>Swiftê°€ í—ˆìš©í•œ 4,194,304 ë°”ì´íŠ¸ë³´ë‹¤ í° ë°ì´í„°ë¥¼ UserDefaultsì— ì €ì¥í•  ìˆ˜ ì—†ë‹¤ëŠ” ì—ëŸ¬ì…ë‹ˆë‹¤.</p>

<p>UserDefaultsëŠ” ì‘ì€ ë°ì´í„°ë“¤ì„ ì €ì¥í•  ëª©ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê²ƒì´ê¸° ë•Œë¬¸ì— ìœ„ì™€ ê°™ì€ ì—ëŸ¬ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ í˜„ìƒì¸ ë“¯ í•©ë‹ˆë‹¤.</p>

<p>ì§€ê¸ˆ ì €ì¥í•˜ë ¤ëŠ” ì´ë¯¸ì§€ëŠ” ì›ë³¸ ì´ë¯¸ì§€ ê·¸ ìì²´ì˜€ìœ¼ë‹ˆ ë‹¹ì—°íˆ ìš©ëŸ‰ì´ ì»¸ì„ ê²ƒì´ê³ , ì´ë¯¸ì§€ì˜ ìš©ëŸ‰ì„ ì¤„ì´ë ¤ë©´ ë³´í†µ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ê² ë‹¤ëŠ” ìƒê°ë¶€í„° í•˜ê² ì£ ?</p>

<p><strong>ì´ë¯¸ì§€ í¬ê¸°ì˜ ì¶•ì†Œ</strong>ëŠ” ê°€ì¥ ì§ê´€ì ìœ¼ë¡œ ì´ë¯¸ì§€ ìš©ëŸ‰ì„ ì¤„ì´ê³  ë©”ëª¨ë¦¬ ê°€ìš©ë¥ ë„ ë†’ì´ëŠ” ì¢‹ì€ ë°©ë²• ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.</p>

<p>ê·¸ë˜ì„œ ì €ë„ ì´ë¯¸ì§€ë¥¼ ì¤„ì¼ ìˆ˜ ìˆëŠ” ë°©ë²•ë¶€í„° ì°¾ì•„ë³´ê²Œ ë˜ì—ˆì£ .</p>

<h2 id="ì´ë¯¸ì§€-ë¦¬ì‚¬ì´ì¦ˆì‹œì˜-cpuì™€-ë©”ëª¨ë¦¬-ë™ì‘">ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì¦ˆì‹œì˜ CPUì™€ ë©”ëª¨ë¦¬ ë™ì‘</h2>

<p>í•˜ì§€ë§Œ ê³µë¶€ë¥¼ í•œ ì§€ ì–¼ë§ˆ ì§€ë‚˜ì§€ ì•Šì•„ ë‹¨ìˆœíˆ ì´ë¯¸ì§€ë¥¼ ì¤„ì´ëŠ” ë°©ë²•ì€ ì¢‹ì€ ë°©ë²•ì´ ì•„ë‹ˆê³ , ì˜¤íˆë ¤ ì•±ì´ ê¸°ê¸°ì— ê³¼ë¶€í•˜ë¥¼ ë” ì¤„ ìˆ˜ ìˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤.</p>

<p>ê·¸ ê¹Œë‹­ì€ 2018ë…„ì— ì§„í–‰ëœ WWDC2018ì—ì„œ ì°¾ì•„ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.</p>

<p><a href="https://developer.apple.com/wwdc18/219">Image and Graphics Best Practices - WWDC18 - Videos - Apple Developer</a></p>

<p>ì´ë¯¸ ì´ë¯¸ì§€ ì²˜ë¦¬ ê²Œì‹œë¬¼ë“¤ì—ì„œ ë§ì´ ë‹¤ë£¨ê³  ìˆê³  iOSì˜ í™”ë©´ í‘œí˜„ ë°©ë²•ì„ í•™ìŠµí•´ë³¼ ìˆ˜ ìˆëŠ” ì„¸ì…˜ì…ë‹ˆë‹¤.</p>

<p>ì•„ë˜ëŠ” <code class="language-plaintext highlighter-rouge">UIGraphicsImageRenderer</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ <code class="language-plaintext highlighter-rouge">PHPicker</code>ë¥¼ í†µí•´ ë°›ì€ ì´ë¯¸ì§€ ì—¬ëŸ¬ê°œì˜ í¬ê¸°ë¥¼ ì¤„ì´ëŠ” ì½”ë“œì…ë‹ˆë‹¤.</p>

<p><img src="https://i.imgur.com/qZZB9BM.png" alt=""></p>

<pre><code class="language-Swift">var images: [UIImage] = []

var result in results {
	result.itemProvider.loadObject(ofClass: UIImage.self) { object, error in
		guard let image = object as? UIImage else { return }
		guard let resizedImage: UIImage = UIGraphicsImageRenderer(size: CGSize(width: 2_000, height: 2_000)).image { context in
			image.draw(in: CGRect(origin: CGPoint.zero, size: newSize))
		} else { return }
		images.append(resizedImage)
	}
}
</code></pre>

<p>ë‹¨ìˆœíˆ ë³´ê¸°ì—ëŠ” ì•„ë¬´ëŸ° ë¬¸ì œê°€ ì—†ì–´ë³´ì´ì£ .</p>

<p>ë¬¸ì œëŠ” ë‘ ë²ˆì— ê±¸ì³ì„œ ë°œìƒí•©ë‹ˆë‹¤.</p>

<h3 id="1-ì›ë³¸ì„-ë¡œë“œí•œë‹¤">1. ì›ë³¸ì„ ë¡œë“œí•œë‹¤.</h3>

<pre><code class="language-Swift">guard let image = object as? UIImage else { return }
</code></pre>

<p>ì²« ë²ˆì§¸ ë¬¸ì œì…ë‹ˆë‹¤.</p>

<p>ì´ë¯¸ì§€ ì‚¬ì´ì¦ˆë¥¼ ì¤„ì´ëŠ” ëª©ì ì´ ë¬´ì—‡ì´ì˜€ë‚˜ìš”?</p>

<p>ë©”ëª¨ë¦¬ì— ë¶€í•˜ë¥¼ ëœ ì£¼ê¸° ìœ„í•´ì„œì˜€ì£ .</p>

<p>ìœ„ ë°©ë²•ì€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰ë§Œ ëœë‹¤ë©´ ê·¸ ì´í›„ì—ëŠ” ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì„ ë‚®ì¶°ì¤„ê²ë‹ˆë‹¤.</p>

<p>ê·¸ëŸ°ë° ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ì¤„ì´ê¸° ìœ„í•´ì„œ ìš°ì„  ì›ë³¸ ì´ë¯¸ì§€ë¥¼ í•œ ë²ˆ ë¡œë“œí•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.</p>

<p>ê·¸ í•œ ë²ˆ ë¡œë“œí•˜ëŠ” ê³¼ì •ì—ì„œ ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…ë“¤ì„ ì¢…ë£Œì‹œí‚¤ê±°ë‚˜ ì‹¬í•˜ë©´ ì•± ìì²´ë¥¼ ì¢…ë£Œì‹œí‚¤ëŠ” í˜„ìƒì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p>ì‹¤ì œë¡œ ìœ„ ì½”ë“œë§Œ ë´ë„ <code class="language-plaintext highlighter-rouge">PHPicker</code>ëŠ” ì„ íƒí•œ ë°ì´í„°ë¥¼ <code class="language-plaintext highlighter-rouge">UIImage</code> íƒ€ì…ìœ¼ë¡œì„œ ì œê³µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

<p>êµ³ì´ í¬ê¸°ê°€ í° ê·¸ ë°ì´í„°ë¥¼ ì•„ë¬´ëŸ° ì²˜ë¦¬ ì—†ì´ <code class="language-plaintext highlighter-rouge">UIImage</code>ë¡œ ë°”ë¡œ ë³€í™˜í•˜ì—¬ ì‚¬ìš©í•˜ê³  ìˆì—ˆë˜ ê²ƒì´ì£ !</p>

<h3 id="2-ì‘ì€-ì´ë¯¸ì§€ë¥¼-ì§ì ‘-ê·¸ë¦°ë‹¤">2. ì‘ì€ ì´ë¯¸ì§€ë¥¼ <strong>ì§ì ‘ ê·¸ë¦°ë‹¤</strong>.</h3>

<pre><code class="language-Swift">image.draw(in: CGRect(origin: .zero, size: newSize))
</code></pre>

<p>ë‘ ë²ˆì§¸ ë¬¸ì œì…ë‹ˆë‹¤.</p>

<p>ìœ„ ë°©ë²•ì€ ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì™€ ê·¸ ì´ë¯¸ì§€ì˜ ì‘ì€ ë²„ì „ì„ <code class="language-plaintext highlighter-rouge">draw</code> ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì§ì ‘ ê·¸ë ¤ì¤˜ì•¼ í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p>

<p>ê·¸ë˜í”½ ì‘ì—…ì„ í•˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— CPUì™€ ë©”ëª¨ë¦¬ ë‘ í•˜ë“œì›¨ì–´ ëª¨ë‘ì—ê²Œ ì‘ì—…ì„ ë¶€ì—¬í•˜ëŠ” ê²ƒì´ê³ , ì´ ë˜í•œ ë©”ëª¨ë¦¬ ë¶€í•˜ë¥¼ ì¤„ì´ëŠ” ê²ƒê³¼ëŠ” ê±°ë¦¬ê°€ ë¨¼ ê²ƒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h2 id="ë‹¤ìš´-ìƒ˜í”Œë§">ë‹¤ìš´ ìƒ˜í”Œë§</h2>

<p>ê·¸ëŸ¬ë©´ ë‹¨ìˆœíˆ ì´ë¯¸ì§€ë¥¼ ë¦¬ì‚¬ì´ì§• í•˜ëŠ” ë°©ë²• ì™¸ì— ì–´ë–¤ ë°©ë²•ì´ ìˆì„ê¹Œìš”?</p>

<p><img src="https://i.imgur.com/QEsP6KF.png" alt=""></p>

<p>ë°”ë¡œ ë°ì´í„°ë¥¼ <code class="language-plaintext highlighter-rouge">UIImage</code>ë¡œ ë°”ë¡œ ë³€í™˜í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ <code class="language-plaintext highlighter-rouge">CGImage</code> íƒ€ì…ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ë””ì½”ë”©í•  íŒŒì¼(data buffer) ìì²´ì˜ ì‚¬ì´ì¦ˆë¥¼ ì¤„ì´ëŠ” ë‹¤ìš´ìƒ˜í”Œë§ ë°©ë²•ì´ ìˆìŠµë‹ˆë‹¤.</p>

<p>ë‹¤ë§Œ ì´ ë°©ë²•ì€ <code class="language-plaintext highlighter-rouge">Core Graphics</code>ì´ë¼ëŠ” í•œ ì¸µ ë” low-levelí•œ ë‚´ìš©ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— ì½”ë“œê°€ ì¢€ ë” ê¸¸ê³  ë³µì¡í•©ë‹ˆë‹¤.</p>

<pre><code class="language-Swift">func downsample(at url: URL, to pointSize: CGSize, scale: CGFloat) -&gt; Data? {

	let sourceOptions = [kCGImageSourceShouldCache: false] as CFDictionary

	guard let source = CGImageSourceCreateWithURL(url as CFURL, sourceOptions) else { return nil }

	let maxDimensionInPixels = max(pointSize.width, pointSize.height) * scale

	let downsampleOptions = [
		kCGImageSourceCreateThumbnailFromImageAlways: true,
		kCGImageSourceCreateThumbnailWithTransform: true,
		kCGImageSourceThumbnailMaxPixelSize: maxDimensionInPixels
	] as CFDictionary

	guard let cgImage = CGImageSourceCreateThumbnailAtIndex(source, 0, downsampleOptions) else { return nil }

	let data = NSMutableData()

	guard let imageDestination = CGImageDestinationCreateWithData(data, UTType.jpeg.identifier as CFString, 1, nil) else { return nil }

	let isPNG: Bool = {
		guard let utType = cgImage.utType else { return false }
		return (utType as String) == UTType.png.identifier
	}()

	let destinationProperties = [
		kCGImageDestinationLossyCompressionQuality: isPNG ? 1.0 : 0.75
	] as CFDictionary

	CGImageDestinationAddImage(imageDestination, cgImage, destinationProperties)
	CGImageDestinationFinalize(imageDestination)

	return data as Data
}
</code></pre>

<blockquote>
  <p>ì–´ì§ˆì–´ì§ˆí•˜ì¥¬..? ğŸ˜µ</p>
</blockquote>

<p>ë³µì¡í•´ ë³´ì´ì§€ë§Œ ë‘ íŒŒíŠ¸ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•œ ë²ˆ ì‚´í´ë´…ì‹œë‹¤.</p>

<h3 id="1-cgimage-ìƒì„±">1. <strong>CGImage</strong> ìƒì„±</h3>

<pre><code class="language-Swift">let sourceOptions = [kCGImageSourceShouldCache: false] as CFDictionary
guard let source = CGImageSourceCreateWithURL(url as CFURL, sourceOptions) else { return nil }

let maxDimensionInPixels = max(pointSize.width, pointSize.height) * scale
let downsampleOptions = [
	kCGImageSourceCreateThumbnailFromImageAlways: true,  
	kCGImageSourceShouldCacheImmediately: true,
	kCGImageSourceCreateThumbnailWithTransform: true,
	kCGImageSourceThumbnailMaxPixelSize: maxDimensionInPixels
] as CFDictionary

guard let cgImage = CGImageSourceCreateThumbnailAtIndex(source, 0, downsampleOptions) else { return nil }
</code></pre>

<p>downsamplingì˜ í•µì‹¬ì´ ë˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.</p>

<p>ì‚¬ì‹¤ìƒ í•„ìˆ˜ì ì¸ ë¡œì§ë“¤ì€ ì´ ì•ˆì— ë‹¤ ìˆìŠµë‹ˆë‹¤.</p>

<p>Option flagë¥¼ ì •ì˜í•´ì£¼ê³  í•´ë‹¹ ì˜µì…˜ì„ í†µí•´ <code class="language-plaintext highlighter-rouge">CGImage</code>ë¥¼ ìƒì„±í•´ì£¼ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.</p>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">kCGImageSourceShouldCache: false</code>
    <ul>
      <li>ì´ë¯¸ì§€ ì†ŒìŠ¤ì—  ëŒ€í•œ ì°¸ì¡°ê°’ë§Œì„ ìƒì„±í•˜ê³  <code class="language-plaintext highlighter-rouge">CGImageSource</code>ê°€ ìƒì„±ë˜ëŠ” ì¦‰ì‹œ ë””ì½”ë”©ì„ ì§„í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">kCGImageSourceShouldCacheImmediately: true</code>
    <ul>
      <li>ì•ì„  ì˜µì…˜ê³¼ëŠ” ë°˜ëŒ€ë¡œ ë‹¤ìš´ìƒ˜í”Œë§ ë¡œì§ì´ ì‹œì‘ë¨ê³¼ ë™ì‹œì— ë””ì½”ë”© ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">kCGImageSourceCreateThumbnailWithTransform: true</code>
    <ul>
      <li>ë‹¤ìš´ìƒ˜í”Œë§ëœ ì´ë¯¸ì§€ë¥¼ ì›ë³¸ ì´ë¯¸ì§€ì™€ ê°™ì€ í˜•íƒœë¥¼ ê°–ë„ë¡ í•©ë‹ˆë‹¤.</li>
    </ul>
  </li>
</ul>

<h3 id="2-png-í€„ë¦¬í‹°-ë³´ì¡´">2. PNG í€„ë¦¬í‹° ë³´ì¡´</h3>

<pre><code class="language-Swift">let data = NSMutableData()

guard let imageDestination = CGImageDestinationCreateWithData(data, UTType.jpeg.identifier as CFString, 1, nil) else { return nil }

let isPNG: Bool = {
	guard let utType = cgImage.utType else { return false }
	return (utType as String) == UTType.png.identifier
}()

let destinationProperties = [
	kCGImageDestinationLossyCompressionQuality: isPNG ? 1.0 : 0.75
] as CFDictionary

CGImageDestinationAddImage(imageDestination, cgImage, destinationProperties)
CGImageDestinationFinalize(imageDestination)

return data as Data
</code></pre>

<p>ì´ ë¶€ë¶„ì€ ì‚¬ì‹¤ ì„ íƒì ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ ë˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">PNG</code> í™•ì¥ìëŠ” ë³´í†µ ìŠ¤í¬ë¦°ìƒ·ê³¼ ê°™ì´ ì´ë¯¸ì§€ì˜ í’ˆì§ˆì´ ì¤‘ìš”í•œ ì´ë¯¸ì§€ë“¤ì— ì‚¬ìš©ë©ë‹ˆë‹¤.</p>

<p>ì´ëŸ¬í•œ ì´ë¯¸ì§€ì˜ í’ˆì§ˆì´ ì†ìƒëœë‹¤ë©´ ì´ë¯¸ì§€ì— í¬í•¨ëœ í…ìŠ¤íŠ¸ ë“±ì˜ ì‹œì¸ì„±, ê°€ë…ì„±ì´ ì¤‘ìš”í•œ ìš”ì†Œë“¤ì— ì˜í–¥ì´ ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<p><code class="language-plaintext highlighter-rouge">PNG</code> í™•ì¥ìë¼ë©´ 1.0ì˜ ì†ìƒ ì—†ëŠ” ì••ì¶•ì„, ê·¸ ì™¸ì˜ í™•ì¥ìë¼ë©´ 0.75ì˜ ì••ì¶•ë¥ ë¡œ ë°ì´í„°ë¥¼ ë””ì½”ë”©í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<h4 id="phpickerì™€ì˜-ì‚¬ìš©">
<code class="language-plaintext highlighter-rouge">PHPicker</code>ì™€ì˜ ì‚¬ìš©</h4>

<p>ì´ì „ <code class="language-plaintext highlighter-rouge">PHPicker</code>ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<pre><code class="language-Swift">itemProvider.loadObject(ofClass: UIImage.self) { image, error in
	// do something
}
</code></pre>

<p>ì´ë²ˆ ê²Œì‹œë¬¼ì—ì„œ ì‚¬ìš©í•œ ë°©ë²•ì€ <code class="language-plaintext highlighter-rouge">URL</code> íƒ€ì…ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ë°›ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<pre><code class="language-Swift">itemProvider.loadFileRepresentation(forTypeIdentifier: UTType.image.identifier) { url, error in
	// do something
}
</code></pre>
</body></html>
