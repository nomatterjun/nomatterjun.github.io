<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h1 id="reactorkit">ReactorKit</h1>

<p>ì•±ìŠ¤í† ì–´ì— ë“±ë¡ëœ ì•±ë“¤ì˜ ì˜¤í”ˆì†ŒìŠ¤ë¥¼ í›”ì³ë³´ë©´ ê½¤ë‚˜ ìì£¼ ë³´ì˜€ë˜ ReactorKitì…ë‹ˆë‹¤.</p>

<p>ì‚¬ì‹¤ ë§‰ì—°í•˜ê²Œ React Nativeë‘ ê´€ë ¨ëœê±´ê°€ë³´ë‹¤~ í•˜ê³  ì§€ë‚˜ì¹˜ê³¤ í–ˆì—ˆëŠ”ë°.. ì „í˜€ ì•„ë‹ˆì˜€ì£ ? ğŸ˜œ</p>

<p>ê²¨ìš¸ í”„ë¡œì íŠ¸ ë™ì•ˆ ì‚¬ìš©í•´ì•¼ í•  ê²ƒ ê°™ì•„ì„œ ê³µë¶€í•´ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤!</p>

<blockquote>
  <p><a href="https://github.com/ReactorKit/ReactorKit">ReactorKit</a></p>
</blockquote>

<p><strong>ReactorKit</strong>ì€ <strong>RxSwift</strong>ë¥¼ ì œëŒ€ë¡œ, ë˜ í¸í•˜ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë‚˜ì˜¨ í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤.</p>

<p>ê³µì‹ githubì— ì„¤ëª…ëœ ê¸€ì„ ì½ì–´ë³´ë©´, ReactorKitì€ <strong>ë¦¬ì•¡í‹°ë¸Œ</strong>í•˜ê³  <strong>ì¼ë°©ì„±</strong>ì„ ê°–ëŠ” Swift ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì§€ì›í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì¡Œë‹¤ê³  í•©ë‹ˆë‹¤.</p>

<p>ë¦¬ì•¡í‹°ë¸Œí•œê±°ì•¼ RxSwift ê¸°ë°˜ì´ë‹ˆ ê·¸ë ‡ë‹¤ê³  ì¹˜ê³ , <strong>ì¼ë°©ì„±</strong>ì— ì£¼ëª©í•˜ê³  ê³µë¶€ë¥¼ í•´ë³´ë©´ ë˜ê² ë„¤ìš”!</p>

<h2 id="ê¸°ë³¸-ì»¨ì…‰">ê¸°ë³¸ ì»¨ì…‰</h2>

<p><img src="https://i.imgur.com/utDbuI4.png" width="500"></p>

<p>ReactorKitì€ <code class="language-plaintext highlighter-rouge">View</code>ì™€ <code class="language-plaintext highlighter-rouge">Reactor</code>ë¼ëŠ” ê²ƒ ì‚¬ì´ë¥¼ ìœ ì €ì˜ <code class="language-plaintext highlighter-rouge">Action</code>ê³¼ ë·°ì˜ <code class="language-plaintext highlighter-rouge">State</code>ë¥¼ <code class="language-plaintext highlighter-rouge">Observable stream</code>ì„ ë§Œë“¤ì–´ ì „ë‹¬í•œë‹¤ê³  í•©ë‹ˆë‹¤.</p>

<p>ë‹¹ìµœ ë¬´ìŠ¨ ë§ì¸ì§€ ì•Œ ìˆ˜ê°€ ì—†ë„¤ìš” ğŸ¤¯</p>

<p>í•˜ë‚˜ì”© ì°¨ê·¼ì°¨ê·¼ ë´…ì‹œë‹¤.</p>

<h3 id="view">View</h3>

<p><code class="language-plaintext highlighter-rouge">View</code>ëŠ” ìš°ë¦¬ê°€ ìƒê°í•˜ëŠ” ê·¸ <code class="language-plaintext highlighter-rouge">View</code> ìì²´ì…ë‹ˆë‹¤.</p>

<p>í™”ë©´ì„ í‘œì‹œí•˜ëŠ” ëª¨ë“  ìš”ì†Œë“¤ì„ <code class="language-plaintext highlighter-rouge">View</code>ë¼ê³  í•˜ê³  ì´ <code class="language-plaintext highlighter-rouge">View</code>ë“¤ì€ ìœ ì €ì˜ ì…ë ¥ì„ action streamìœ¼ë¡œ bindí•˜ê±°ë‚˜ ê°ê°ì˜ UI Componentë“¤ì—ê²Œ view statesë¥¼ <code class="language-plaintext highlighter-rouge">bind</code>í•œë‹¤ê³  í•©ë‹ˆë‹¤.</p>

<p>ê·¸ëŸ¬ë‹ˆê¹Œ <strong>1. ìœ ì €ì˜ ì¸í„°ë™ì…˜ì„ ë°›ê±°ë‚˜</strong> <strong>2. í•˜ìœ„ UI Componentë“¤ì—ê²Œ <code class="language-plaintext highlighter-rouge">Reactor</code>ì˜ ìƒíƒœë¥¼ ì•Œë ¤ì¤€ë‹¤</strong>ëŠ” ëœ»ì¸ ê²ƒ ê°™ë„¤ìš”.</p>

<p>ì´ <code class="language-plaintext highlighter-rouge">View</code>ì—ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì—†ë‹¤ê³  í•©ë‹ˆë‹¤. ë‹¨ì§€ ì „ë‹¬ìì˜ ì—­í• ë§Œ í•œë‹¤ê³  ë³´ë©´ ë  ê²ƒ ê°™ì•„ìš”!</p>

<p><code class="language-plaintext highlighter-rouge">View Controller</code>ê°€ <code class="language-plaintext highlighter-rouge">View</code>ë¼ëŠ” ê²ƒì„ ëª…ì‹œí•˜ê¸° ìœ„í•´ì„œ <code class="language-plaintext highlighter-rouge">View</code> í”„ë¡œí† ì½œì„ ì±„íƒí•˜ë¼ê³  í•©ë‹ˆë‹¤.</p>

<pre><code class="language-Swift">class ProfileViewController: UIViewController, View {
	var disposeBag = DisposeBag()
}
</code></pre>

<p><code class="language-plaintext highlighter-rouge">View</code> í”„ë¡œí† ì½œì„ ì±„íƒí•˜ëŠ” ê²ƒ ë§Œìœ¼ë¡œ ì´ ë·°ì»¨ì€ <code class="language-plaintext highlighter-rouge">reactor</code> í”„ë¡œí¼í‹°ë¥¼ ê°–ê²Œ ë©ë‹ˆë‹¤.</p>

<pre><code class="language-Swift">profileViewController.reactor = UserViewReactor()
</code></pre>

<p>ìœ„ì™€ ê°™ì€ ì‘ì—…ì´ ìë™ìœ¼ë¡œ ì´ë£¨ì–´ì§„ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.</p>

<p>ì´ë ‡ê²Œ ì£¼ì–´ì§„ <code class="language-plaintext highlighter-rouge">reactor</code>ë¼ëŠ” í”„ë¡œí¼í‹°ê°€ ë³€ê²½ë˜ê²Œ ë˜ë©´, <code class="language-plaintext highlighter-rouge">bind(reactor:)</code> ë©”ì„œë“œê°€ ìë™ìœ¼ë¡œ í˜¸ì¶œë©ë‹ˆë‹¤. action streamê³¼ state streamì„ ì •ì˜í•˜ê¸° ìœ„í•´ ë·°ì»¨ ì•ˆì— ì´ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì¤ì‹œë‹¤.</p>

<pre><code class="language-Swift">func bind(reactor: ProfileViewReactor) {
	// action (View -&gt; Reactor)
	refreshButton.rx.tap.map { Reactor.Action.refresh }
		.bind(to: reactor.action)
		.disposed(by: self.disposeBag)

	// state (Reactor -&gt; View)
	reactor.state.map { $0.isFollowing }
		.bind(to: followButton.rx.isSelected)
		.disposed(by: self.disposeBag)
}
</code></pre>

<p>ìŠ¤í† ë¦¬ë³´ë“œë„ ì§€ì›í•œë‹¤ê³  í•©ë‹ˆë‹¤!</p>

<p>ìŠ¤í† ë¦¬ë³´ë“œë¥¼ ì‚¬ìš©í•˜ëŠ” ë·°ì»¨ì€ <code class="language-plaintext highlighter-rouge">View</code>ê°€ ì•„ë‹ˆë¼ <code class="language-plaintext highlighter-rouge">StoryboardView</code>ë¥¼ ì±„íƒí•´ì•¼ í•©ë‹ˆë‹¤!</p>

<pre><code class="language-Swift">class MyViewController: UIViewController, StoryboardView {
	func bind(reactor: MyReactor) {
		...
	}
}
</code></pre>

<h3 id="reactor">Reactor</h3>

<p><code class="language-plaintext highlighter-rouge">Reactor</code>ëŠ” UIì™€ëŠ” ì „í˜€ ê´€ë ¨ì—†ëŠ” ë…ë¦½ëœ ë ˆì´ì–´ ê³„ì¸µì…ë‹ˆë‹¤.</p>

<p>í•˜ì§€ë§Œ <code class="language-plaintext highlighter-rouge">View</code>ì˜ ìƒíƒœë¥¼ ê²°ì •í•´ì£¼ëŠ” ì•„ì£¼ ì¤‘ëŒ€í•œ ì—­í• ì„ í•©ë‹ˆë‹¤.</p>

<p>ëª¨ë“  <code class="language-plaintext highlighter-rouge">View</code>ëŠ” ê°ìì˜ <code class="language-plaintext highlighter-rouge">Reactor</code>ë¥¼ ê°€ì ¸ì•¼í•˜ê³ , ëª¨ë“  ë¡œì§ì„ ê·¸ <code class="language-plaintext highlighter-rouge">Reactor</code>ì— ìœ„ì„(delegate)í•©ë‹ˆë‹¤.</p>

<p>ê·¸ëŸ¬ë©´ì„œë„ <code class="language-plaintext highlighter-rouge">Reactor</code>ëŠ” <code class="language-plaintext highlighter-rouge">View</code>ì— ëŒ€í•œ ì˜ì¡´ì„±ì´ 1ë„ ì—†ê¸° ë•Œë¬¸ì— Unit Testí•˜ê¸°ì—ë„ ìˆ˜ì›”í•˜ë‹¤ê³  í•˜ë„¤ìš”!</p>

<p><code class="language-plaintext highlighter-rouge">Reactor</code>ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” <code class="language-plaintext highlighter-rouge">View</code>ì™€ ë§ˆì°¬ê°€ì§€ë¡œ <code class="language-plaintext highlighter-rouge">Reactor</code> í”„ë¡œí† ì½œì„ ì±„íƒí•´ì•¼ í•©ë‹ˆë‹¤.</p>

<p>ì´ í”„ë¡œí† ì½œì„ ì±„íƒí•œ ê°ì²´ëŠ” <code class="language-plaintext highlighter-rouge">Action</code>, <code class="language-plaintext highlighter-rouge">Mutation</code>, <code class="language-plaintext highlighter-rouge">State</code> ì„¸ê°€ì§€ íƒ€ì…ì„ ê°€ì ¸ì•¼í•©ë‹ˆë‹¤.</p>

<p>ë˜í•œ <code class="language-plaintext highlighter-rouge">initialState</code>ë¼ëŠ” í”„ë¡œí¼í‹°ë„ ê°€ì ¸ì•¼ í•œë‹¤ê³  í•©ë‹ˆë‹¤.</p>

<pre><code class="language-Swift">class ProfileViewReactor: Reactor {
	// represent user actions
	enum Action {
		case refreshFollowingStatus(Int)
		case follow(Int)
	}

	// represent state changes
	enum Mutation { 
		case setFollowing(Bool)
	}

	// represents the current view state
	struct State {
		var isFollowing: Bool = false
	}

	let initialState: State = State()
}
</code></pre>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Action</code>
ìœ ì € ì¸í„°ë™ì…˜ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">State</code>
<code class="language-plaintext highlighter-rouge">View</code>ì˜ ìƒíƒœë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
  </li>
  <li>
    <p>Mutation
<code class="language-plaintext highlighter-rouge">Action</code>ê³¼ <code class="language-plaintext highlighter-rouge">State</code>ë¥¼ ì´ì–´ì£¼ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.</p>
  </li>
</ul>

<p><code class="language-plaintext highlighter-rouge">Reactor</code>ëŠ” ë‘ ë‹¨ê³„ë¥¼ ê±°ì³ action streamì„ state streamìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.</p>

<p><img src="https://i.imgur.com/yJ9zsoJ.png" width="500"></p>

<p>ë°”ë¡œ <code class="language-plaintext highlighter-rouge">mutate()</code>ì™€ <code class="language-plaintext highlighter-rouge">reduce()</code>ë¥¼ í†µí•´ì„œì£ .</p>

<p><code class="language-plaintext highlighter-rouge">mutate()</code>ëŠ” <code class="language-plaintext highlighter-rouge">Action</code>ì„ ë°›ì•„ <code class="language-plaintext highlighter-rouge">Observable&lt;Mutation&gt;</code>ì„ ìƒì„±í•©ë‹ˆë‹¤.</p>

<p>ëª¨ë“  ë¹„ë™ê¸° ì‘ì—…ë“¤ì´ë‚˜ API í˜¸ì¶œ ë“±ì´ ì—¬ê¸°ì— ë“¤ì–´ê°€ëŠ” ì‘ì—…ì´ë¼ê³  í•©ë‹ˆë‹¤.</p>

<pre><code class="language-Swift">func mutate(action: Action) -&gt; Observable&lt;Mutation&gt; {
	switch action {
	case let .refreshFollowingStatus(userID): // receive action
		return UserAPI.isFollowing(userID) // create API stream
			.map { (isFollowing: Bool) -&gt; Mutation in
				return Mutation.setFollowing(isFollowing) // convert to Mutation stream
			}
	case let .follow(userID):
		return UserAPI.follow()
			.map { _ -&gt; Mutation in
				return Mutation.setFollowing(true)
			}
	}
}
</code></pre>

<p><code class="language-plaintext highlighter-rouge">reduce()</code>ëŠ” ì´ì „ì˜ <code class="language-plaintext highlighter-rouge">State</code>ì™€ <code class="language-plaintext highlighter-rouge">Mutation</code>ìœ¼ë¡œë¶€í„° ìƒˆë¡œìš´ <code class="language-plaintext highlighter-rouge">State</code>ë¥¼ ë§Œë“œëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤.</p>

<p>ìƒˆë¡œìš´ <code class="language-plaintext highlighter-rouge">State</code>ë¥¼ ë™ê¸°ì ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” ê¸°ëŠ¥ ì™¸ì˜ ê¸°ëŠ¥ì€ ë„£ì§€ ë§ë¼ê³  í•˜ë„¤ìš”.</p>

<pre><code class="language-Swift">func reduce(state: State, mutation: Mutation) -&gt; State {
	var state = state // create a copy of old state
	switch mutation {
	case let .setFollowing(isFollowing):
		state.isFollowing = isFollowing // manipulate the state, creating a new state
		return state // return new state
	}
}
</code></pre>

<p><code class="language-plaintext highlighter-rouge">transform()</code>ì€ ê° streamì„ ë‹¤ë¥¸ streamìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê¸°ëŠ¥ì„ í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤.</p>

<pre><code class="language-Swift">func transform(action: Observable&lt;Action&gt;) -&gt; Observable&lt;Action&gt;
func transform(mutation: Observable&lt;Mutation&gt;) -&gt; Observable&lt;Mutation&gt;
func transform(state: Observable&lt;State&gt;) -&gt; Observable&lt;State&gt;
</code></pre>

<h2 id="ì‹¬í™”">ì‹¬í™”</h2>

<h3 id="global-states">Global States</h3>

<p>Reduxì™€ ë‹¤ë¥´ê²Œ <strong>ReactorKit</strong>ì€ global app stateë¥¼ ì •ì˜í•˜ì§€ ì•ŠëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤.</p>

<p>ì €ëŠ” Reduxê°€ ë­”ì§€ ëª¨ë¥´ë‹ˆ ì¼ë‹¨ ë„˜ì–´ê°€ë³¼ê²Œìš”..</p>

<p>ê·¸ë ‡ê¸° ë•Œë¬¸ì— global stateë¥¼ ì•„ë¬´ê±¸ë¡œë‚˜ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ê³  í•©ë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">BehaviorSubject</code>ë‚˜ <code class="language-plaintext highlighter-rouge">PublishSubject</code>, í˜¹ì€ <code class="language-plaintext highlighter-rouge">reactor</code>ë¥¼ ì‚¬ìš©í•´ì„œ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤ê³  í•˜ë„¤ìš”.</p>

<p>ë™ì‹œì— global stateë¥¼ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œí•˜ì§€ë„ ì•ŠëŠ”ë‹¤ê³  í•©ë‹ˆë‹¤.</p>

<p>ReactorKitì—ëŠ” <strong>Action â¡ï¸ Mutation â¡ï¸ State</strong> Flowê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>

<p>ê·¸ë˜ì„œ global stateë¥¼ <code class="language-plaintext highlighter-rouge">Mutation</code>ìœ¼ë¡œ ë³€í™˜í•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">transform(mutation:</code>ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<pre><code class="language-Swift">var currentUser: BehaviorSubject&lt;User&gt; // global state

func transform(mutation: Observable&lt;Mutation&gt;) -&gt; Observable&lt;Mutation&gt; {
	return Observable.merge(mutation, currentUser.map(Mutation.setUser))
}
</code></pre>

<p>ìœ„ ì˜ˆì‹œëŠ” <code class="language-plaintext highlighter-rouge">currentUser</code>ê°€ ë°”ë€” ë•Œ  <code class="language-plaintext highlighter-rouge">Mutation.setUser</code>ë¥¼ ì‹¤í–‰í•´ë‹¬ë¼ëŠ” ì½”ë“œì…ë‹ˆë‹¤.</p>

<p>*ìŒ.. ğŸ¤” *</p>

<p>*ì´ ë¶€ë¶„ì€ ReactorKitì„ ì‚¬ìš©í•´ê°€ë©´ì„œ ì°¨ì°¨ ì´í•´í•´ë´ì•¼ê² ìŠµë‹ˆë‹¤â€¦ ğŸ˜‚  *</p>

<h3 id="view-communication">View Communication</h3>

<p>Viewê°„ì˜ ë°ì´í„° ì „ë‹¬ì´ ì´ë£¨ì–´ì§ˆ ë•Œ ë³´í†µ <code class="language-plaintext highlighter-rouge">delegate</code> íŒ¨í„´ì´ë‚˜ <code class="language-plaintext highlighter-rouge">closure</code>ë¥¼ ì‚¬ìš©í•˜ì£ ?</p>

<p>ReactorKitì€ ë°ì´í„° ì „ë‹¬ì— ìœ„ ë‘ ê°€ì§€ ë°©ë²•ì„ ì‚¬ìš©í•˜ì§€ ë§ê³  <a href="https://github.com/ReactiveX/RxSwift/blob/master/RxSwift/Reactive.swift">reactive extension</a>ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œí•œë‹¤ê³  í•©ë‹ˆë‹¤.</p>

<pre><code class="language-Swift">// Read as "Reactive Extension where Base is a SomeType"
extension Reactive where Base: SomeType {
	// Any specific reactive extension for SomeType
}
</code></pre>

<p><img src="https://i.imgur.com/0zL1XoU.png" width="500"></p>

<p>View Aë¥¼ <code class="language-plaintext highlighter-rouge">ChatViewController</code>, View Bë¥¼ <code class="language-plaintext highlighter-rouge">MessageInputView</code>ë¼ê³  í•©ì‹œë‹¤.</p>

<p>View BëŠ” View Aì˜ <code class="language-plaintext highlighter-rouge">subview</code>ì…ë‹ˆë‹¤.</p>

<p>View Bê°€ View Aì— <code class="language-plaintext highlighter-rouge">ControlEvent</code>ë¥¼ ë³´ë‚´ë©´ View Aì—ì„œ ë³¸ì¸ì˜ reactorì¸ Reactor Aì— <code class="language-plaintext highlighter-rouge">Action</code>ì„ ì „ë‹¬í•˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ì…ë‹ˆë‹¤.</p>

<p>ì›ë˜ì˜ ë°©ì‹ëŒ€ë¡œ View Bì—ì„œ View Aë¡œ ì´ë²¤íŠ¸ë‚˜ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ë ¤ë©´ <code class="language-plaintext highlighter-rouge">delegate</code>ë‚˜ <code class="language-plaintext highlighter-rouge">closure</code>ë¥¼ ì‚¬ìš©í–ˆì—ˆì£ .</p>

<p>ëŒ€ì‹  ReactorKitì´ ì¶”ì²œí•˜ëŠ” ë°©ì‹ëŒ€ë¡œ <code class="language-plaintext highlighter-rouge">Reactive extension</code>ì„ ì‚¬ìš©í•´ì„œ êµ¬í˜„ì„ í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>

<pre><code class="language-Swift">// MessageInputView.swift
extension Reactive where Base: MessageInputView {
	var sendButtonTap: ControlEvent&lt;String&gt; {
		let source = base.sendButton.rx.tap.withLatestFrom(...)
		return ControlEvent(events: source)
	}
}
</code></pre>

<pre><code class="language-Swift">// ChatViewController.swift
messageInputView.rx.sendButtonTap
	.map(Reactor.Action.send)
	.bind(to: reactor.action)
</code></pre>
</body></html>
